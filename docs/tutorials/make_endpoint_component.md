# エンドポイントのコンポーネント化

### setup メソッドに初期化処理を書く
Endpoint クラスには setup メソッドというインスタンスメソッドがあります．setup メソッドは Endpoint クラスのサブクラスのインスタンスが生成された際に呼び出されます．App オブジェクトはクライアントからリクエストが来てリクエストされた URI に対応する Endpoint を見つけると次のような処理を行います:

1. Endpoint のインスタンスを作る (インスタンスの初期化)
2. setup メソッドを呼び出す
3. リクエストされた HTTP メソッドに対応するコールバックを呼び出す

つまり，setup はコールバック関数の前に実行される関数です．通常はこのメソッドを定義しなくても問題なく動作します (このサンプルでも定義しません)．ただし，Endpoint に拡張性を持たせたい場合などは便利です．なぜなら，Bamboo には setup メソッドの引数を App オブジェクト経由で渡す機能があるからです:

```python
# 今回のサンプルとは関係のないエンドポイントです
@app.route("mock")
class MockEndpoint(Endpoint):

    def setup(self, db):
        # コールバック関数で使えるようにインスタンス変数として代入
        self.db = db


# データベースを操作するオブジェクト db を App オブジェクト経由で渡す
app.set_parcel(MockEndpoint, db)
```

このように setup メソッドを上手く活用すれば，実装した Endpoint サブクラスに拡張性を持たせたり，そのクラスを配布可能にすることが出来ます．